{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>âš™ï¸ ParamÃ¨tres</h2>
  <p class="muted">Personnalisez votre expÃ©rience sur Genius Bot.</p>
  
  <div class="settings-section">
    <h3>ğŸ‘¤ Informations du compte</h3>
    <div class="settings-info-grid">
      <div class="settings-info-item">
        <span class="settings-info-label">Pseudonyme</span>
        <span class="settings-info-value">{{ user_id }}</span>
      </div>
      <div class="settings-info-item">
        <span class="settings-info-label">CrÃ©dits disponibles</span>
        <span class="settings-info-value accent">{{ user.credits }}</span>
      </div>
      <div class="settings-info-item">
        <span class="settings-info-label">Date d'expiration</span>
        <span class="settings-info-value">{{ user.expiration }}</span>
      </div>
    </div>
  </div>

  <div class="settings-section">
    <h3>ğŸ”” Notifications</h3>
    <p class="muted">GÃ©rez vos notifications et alertes.</p>
    <div class="settings-actions">
      <button id="clearNotificationsBtn" class="btn btn-secondary">
        ğŸ—‘ï¸ Supprimer toutes les notifications
      </button>
    </div>
    <div id="notificationFeedback" class="settings-feedback" hidden></div>
  </div>

  <div class="settings-section">
    <h3>ğŸ¨ Apparence</h3>
    <p class="muted">Choisissez votre thÃ¨me prÃ©fÃ©rÃ©.</p>
    <div class="theme-options">
      <label class="theme-option" data-theme="dark">
        <input type="radio" name="theme" value="dark" checked>
        <span class="theme-preview dark-preview">
          <span class="theme-icon">ğŸŒ™</span>
        </span>
        <span class="theme-label">Sombre</span>
      </label>
      <label class="theme-option" data-theme="light">
        <input type="radio" name="theme" value="light">
        <span class="theme-preview light-preview">
          <span class="theme-icon">â˜€ï¸</span>
        </span>
        <span class="theme-label">Clair</span>
      </label>
      <label class="theme-option" data-theme="auto">
        <input type="radio" name="theme" value="auto">
        <span class="theme-preview auto-preview">
          <span class="theme-icon">ğŸŒ“</span>
        </span>
        <span class="theme-label">Auto</span>
      </label>
    </div>
  </div>

  <div class="settings-section">
    <h3>ğŸ“± Application mobile</h3>
    <p class="muted">Installez Genius Bot sur votre appareil pour un accÃ¨s rapide.</p>
    <div class="settings-actions">
      <button id="installPwaBtn" class="btn">
        ğŸ“² Installer l'application
      </button>
    </div>
    <p class="settings-hint">L'installation ajoute Genius Bot Ã  votre Ã©cran d'accueil pour un accÃ¨s instantanÃ©.</p>
  </div>

  <div class="settings-section">
    <h3>ğŸ”’ SÃ©curitÃ©</h3>
    <p class="muted">Options de sÃ©curitÃ© de votre compte.</p>
    <div class="settings-actions">
      <a href="{{ url_for('logout') }}" class="btn danger">
        ğŸšª Se dÃ©connecter
      </a>
    </div>
  </div>

  <div class="settings-section">
    <h3>ğŸ’¡ Raccourcis utiles</h3>
    <div class="shortcuts-grid">
      <a href="{{ url_for('download_page') }}" class="shortcut-item">
        <span class="shortcut-icon">ğŸ“¥</span>
        <span class="shortcut-label">TÃ©lÃ©charger</span>
      </a>
      <a href="{{ url_for('convert_page') }}" class="shortcut-item">
        <span class="shortcut-icon">ğŸµ</span>
        <span class="shortcut-label">Convertir</span>
      </a>
      <a href="{{ url_for('shop') }}" class="shortcut-item">
        <span class="shortcut-icon">ğŸ›’</span>
        <span class="shortcut-label">Boutique</span>
      </a>
      <a href="{{ url_for('home') }}" class="shortcut-item">
        <span class="shortcut-icon">ğŸ </span>
        <span class="shortcut-label">Dashboard</span>
      </a>
      <a href="{{ url_for('about') }}" class="shortcut-item">
        <span class="shortcut-icon">ğŸ“–</span>
        <span class="shortcut-label">Ã€ propos</span>
      </a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Clear notifications button
  var clearBtn = document.getElementById('clearNotificationsBtn');
  var feedback = document.getElementById('notificationFeedback');
  
  if (clearBtn) {
    clearBtn.addEventListener('click', function() {
      clearBtn.disabled = true;
      clearBtn.textContent = 'â³ Suppression...';
      
      fetch('/api/notifications/clear', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(function(response) { return response.json(); })
      .then(function(data) {
        if (data.success) {
          feedback.textContent = 'âœ… Toutes les notifications ont Ã©tÃ© supprimÃ©es !';
          feedback.className = 'settings-feedback success';
        } else {
          feedback.textContent = 'âŒ ' + (data.message || 'Erreur');
          feedback.className = 'settings-feedback error';
        }
        feedback.hidden = false;
        clearBtn.disabled = false;
        clearBtn.textContent = 'ğŸ—‘ï¸ Supprimer toutes les notifications';
      })
      .catch(function() {
        feedback.textContent = 'âŒ Erreur de connexion';
        feedback.className = 'settings-feedback error';
        feedback.hidden = false;
        clearBtn.disabled = false;
        clearBtn.textContent = 'ğŸ—‘ï¸ Supprimer toutes les notifications';
      });
    });
  }
  
  // Install PWA button
  var installBtn = document.getElementById('installPwaBtn');
  var deferredPrompt = null;
  
  window.addEventListener('beforeinstallprompt', function(e) {
    e.preventDefault();
    deferredPrompt = e;
    if (installBtn) {
      installBtn.style.display = 'inline-block';
    }
  });
  
  if (installBtn) {
    installBtn.addEventListener('click', function() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(function(choice) {
          if (choice.outcome === 'accepted') {
            installBtn.textContent = 'âœ… Application installÃ©e !';
            installBtn.disabled = true;
          }
          deferredPrompt = null;
        });
      } else {
        // App might already be installed or not available
        installBtn.textContent = 'âœ… Application dÃ©jÃ  installÃ©e';
        installBtn.disabled = true;
      }
    });
  }
  
  // Theme selection (visual only for now)
  var themeOptions = document.querySelectorAll('.theme-option');
  themeOptions.forEach(function(option) {
    option.addEventListener('click', function() {
      themeOptions.forEach(function(o) { o.classList.remove('selected'); });
      option.classList.add('selected');
      option.querySelector('input').checked = true;
    });
  });
  
  // Set initial selected theme
  var darkOption = document.querySelector('.theme-option[data-theme="dark"]');
  if (darkOption) darkOption.classList.add('selected');
});
</script>
{% endblock %}
