{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>üì• T√©l√©chargement</h2>
  <p class="muted">Convertissez vos vid√©os YouTube pr√©f√©r√©es en MP3 ou MP4 de haute qualit√©.</p>
  
  <form method="post" id="downloadForm">
    <div class="form-group">
      <label class="form-label">üîó Lien YouTube</label>
      <input type="text" name="url" placeholder="https://www.youtube.com/watch?v=..." required>
      <p class="form-hint">Collez l'URL compl√®te de la vid√©o YouTube</p>
    </div>
    
    <div class="form-group">
      <label class="form-label">üì¶ Format de sortie</label>
      <div class="download-options">
        <label class="download-option selected" data-mode="mp3">
          <input type="radio" name="mode" value="mp3" checked>
          <span class="download-option-icon">üéµ</span>
          <span class="download-option-label">MP3</span>
          <span class="download-option-desc">Audio</span>
        </label>
        <label class="download-option" data-mode="mp4">
          <input type="radio" name="mode" value="mp4">
          <span class="download-option-icon">üé•</span>
          <span class="download-option-label">MP4</span>
          <span class="download-option-desc">Vid√©o</span>
        </label>
      </div>
    </div>
    
    <!-- Video Quality Selection (shown only for MP4) -->
    <div class="form-group" id="qualityGroup" style="display:none;">
      <label class="form-label">üì∫ Qualit√© vid√©o</label>
      <div class="quality-options">
        <label class="quality-option" data-quality="240">
          <input type="radio" name="quality" value="240">
          <span class="quality-label">240p</span>
          <span class="quality-desc">√âconomique</span>
        </label>
        <label class="quality-option" data-quality="360">
          <input type="radio" name="quality" value="360">
          <span class="quality-label">360p</span>
          <span class="quality-desc">Standard</span>
        </label>
        <label class="quality-option" data-quality="480">
          <input type="radio" name="quality" value="480">
          <span class="quality-label">480p</span>
          <span class="quality-desc">DVD</span>
        </label>
        <label class="quality-option selected" data-quality="720">
          <input type="radio" name="quality" value="720" checked>
          <span class="quality-label">720p</span>
          <span class="quality-desc">HD</span>
        </label>
      </div>
    </div>
    
    <button type="submit" id="downloadBtn">
      ‚¨áÔ∏è T√©l√©charger (1 cr√©dit)
    </button>
  </form>
  
  {% if msg %}<p class="error">{{ msg }}</p>{% endif %}
  
  <p class="muted" style="text-align:center;margin-top:20px;">
    ‚è≥ Les t√©l√©chargements lourds peuvent prendre du temps. Restez sur la page.
  </p>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const downloadOptions = document.querySelectorAll('.download-option');
  const qualityGroup = document.getElementById('qualityGroup');
  const qualityOptions = document.querySelectorAll('.quality-option');
  const form = document.getElementById('downloadForm');
  const downloadBtn = document.getElementById('downloadBtn');
  
  // Format option selection
  downloadOptions.forEach(function(option) {
    option.addEventListener('click', function() {
      downloadOptions.forEach(function(o) { o.classList.remove('selected'); });
      option.classList.add('selected');
      
      // Show/hide quality options based on mode
      const mode = option.getAttribute('data-mode');
      if (mode === 'mp4') {
        qualityGroup.style.display = 'block';
      } else {
        qualityGroup.style.display = 'none';
      }
    });
  });
  
  // Quality option selection
  qualityOptions.forEach(function(option) {
    option.addEventListener('click', function() {
      qualityOptions.forEach(function(o) { o.classList.remove('selected'); });
      option.classList.add('selected');
    });
  });
  
  // Form submission loading state
  form.addEventListener('submit', function() {
    downloadBtn.disabled = true;
    downloadBtn.textContent = '‚è≥ T√©l√©chargement en cours...';
  });
});
</script>
{% endblock %}