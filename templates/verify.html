{% extends "base.html" %}
{% block content %}
<div class="card auth-form">
  <div class="auth-header">
    <span class="auth-icon">üîê</span>
    <h2 class="auth-title">V√©rification Email</h2>
    <p class="muted">Entrez le code envoy√© √† <strong>{{ email }}</strong></p>
  </div>
  
  <form method="post">
    <div class="form-group">
      <label class="form-label" for="otp-input">Code de v√©rification</label>
      <input type="text" id="otp-input" name="otp" placeholder="Entrez le code √† 6 chiffres" required maxlength="6" pattern="[0-9]{6}" inputmode="numeric" autocomplete="one-time-code">
      <p class="form-hint">Le code est valide pendant 10 minutes</p>
    </div>
    
    <button type="submit">V√©rifier</button>
  </form>
  
  <div class="divider">ou</div>
  
  <div style="text-align:center;">
    <p class="muted" style="margin-bottom:12px;">Vous n'avez pas re√ßu le code ?</p>
    <button id="resendOtpBtn" class="btn-secondary" style="width:100%;">Renvoyer le code</button>
  </div>
</div>

<script>
document.getElementById('resendOtpBtn').addEventListener('click', async function() {
  const btn = this;
  btn.disabled = true;
  btn.textContent = 'Envoi en cours...';
  
  try {
    const response = await fetch('{{ url_for("resend_otp") }}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    const data = await response.json();
    
    if (data.success) {
      btn.textContent = '‚úì Code renvoy√©';
      btn.style.background = 'var(--accent)';
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = 'Renvoyer le code';
        btn.style.background = '';
      }, 5000);
    } else {
      alert('Erreur: ' + data.message);
      btn.disabled = false;
      btn.textContent = 'Renvoyer le code';
    }
  } catch (error) {
    alert('Erreur de connexion');
    btn.disabled = false;
    btn.textContent = 'Renvoyer le code';
  }
});
</script>
{% endblock %}