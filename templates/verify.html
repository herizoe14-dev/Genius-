{% extends "base.html" %}
{% block content %}
<div class="card auth-form">
  <div class="auth-header">
    <span class="auth-icon">ğŸ”</span>
    <h2 class="auth-title">VÃ©rification du Compte</h2>
    <p class="muted">Code envoyÃ© Ã  l'administrateur via Telegram</p>
  </div>
  
  <div style="background: rgba(0,209,122,0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
    <p style="margin: 0; font-size: 0.9rem;">
      ğŸ“± <strong>Instructions :</strong><br>
      1. L'administrateur a reÃ§u votre code OTP via Telegram<br>
      2. Contactez l'administrateur pour obtenir votre code<br>
      3. Entrez le code Ã  6 chiffres ci-dessous
    </p>
  </div>
  
  <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px; margin-bottom: 20px;">
    <p style="margin: 0; font-size: 0.85rem; opacity: 0.8;">
      ğŸ‘¤ <strong>Utilisateur :</strong> {{ email }}
    </p>
  </div>
  
  <form method="post">
    <div class="form-group">
      <label class="form-label" for="otp-input">Code de vÃ©rification</label>
      <input type="text" id="otp-input" name="otp" placeholder="Entrez le code Ã  6 chiffres" required maxlength="6" pattern="[0-9]{6}" inputmode="numeric" autocomplete="one-time-code">
      <p class="form-hint">Le code est valide pendant 10 minutes</p>
    </div>
    
    <button type="submit">VÃ©rifier</button>
  </form>
  
  <div class="divider">ou</div>
  
  <div style="text-align:center;">
    <p class="muted" style="margin-bottom:12px;">Vous n'avez pas reÃ§u le code ?</p>
    <button id="resendOtpBtn" class="btn-secondary" style="width:100%;">Renvoyer le code via Telegram</button>
  </div>
</div>

<script>
document.getElementById('resendOtpBtn').addEventListener('click', async function() {
  const btn = this;
  btn.disabled = true;
  btn.textContent = 'Envoi en cours...';
  
  try {
    const response = await fetch('{{ url_for("resend_otp") }}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    const data = await response.json();
    
    if (data.success) {
      btn.textContent = 'âœ“ Code renvoyÃ© via Telegram';
      btn.style.background = 'var(--accent)';
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = 'Renvoyer le code via Telegram';
        btn.style.background = '';
      }, 5000);
    } else {
      alert('Erreur: ' + data.message);
      btn.disabled = false;
      btn.textContent = 'Renvoyer le code via Telegram';
    }
  } catch (error) {
    alert('Erreur de connexion');
    btn.disabled = false;
    btn.textContent = 'Renvoyer le code via Telegram';
  }
});
</script>
{% endblock %}